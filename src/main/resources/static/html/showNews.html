<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>显示新闻</title>
</head>
<body>
显示新闻
<hr>
<form action="javascript:save();" method="post">
    <table align="center" border="1">
        <tr>
            <td>新闻题目：</td>
            <td><input id="title" name="title" type="text" value="" disabled="disabled">
            </td>
        </tr>
        <tr>
            <td>新闻内容：</td>
            <td><textarea cols="50" id="content" name="content" rows="15" disabled="disabled"></textarea></td>
        </tr>
        <tr>
            <td>发布人：</td>
            <td><input id="username" name="username" type="text" value="" disabled="disabled"></td>
        </tr>

        <input name="newsid" newsid type="hidden" value="">

        <tr>
            <td colspan="2">
                <input onclik="" type="submit" value="保存">
                <input type="reset" value="重置">
                <input onclick="back()" type="button" value="返回">
            </td>
        </tr>
    </table>
</form>
<script src="/js/jquery.1.12.4.min.js" type="text/javascript"></script>
<script charset="utf-8" type="text/javascript">


    var news = {
        "content": "",
        "id": 0,
        "pubTime": "2018-1-1",
        "title": "",
        "userId": 0
    }

    var user = {
        "id": 0,
        "userName": "",
        "password": ""
    }

    function syncUI() {
        $("#title").val(news.title)
        $("#content").val(news.content)
        $("#username").val(user.userName)
    }

    function back() {
        window.history.go(-1);
    }

    function getNewsFromInput() {
        news.title = $("#title").val()
        news.content = $("#content").val()
    }

    function getNewsFrom(data) {
        news.title = data.data.title
        news.content = data.data.content
        news.userId = data.data.userId
    }

    function getUsersFrom(data) {
        user.userName =data.data.userName
        return user
    }

    function getUsers(id) {

        $.ajax({
            type: "GET",
            url: "/users/" + id,
            success: function (data) {
                if (data.state == 0) {
                    getUsersFrom(data)
                    syncUI()
                } else {
                    alert(data.message)
                }
            }
        });
    }

    function getNews(id) {

        $.ajax({
            type: "POST",
            // dataType:"json",
            url: "/news/get/" + id,
            // data:{"id":"value"},    //参数值
            success: function (data) {
                if (data.state == 0) {
                    getNewsFrom(data)
                    getUsers(data.data.userId)
                    syncUI()
                } else {
                    alert(data.message)
                }
            }
        });
    }

    function save() {
        getNewsFromInput()
        $.ajax({
            type: "PUT",
            url: "/news/" + news.id,
            contentType: "application/json",
            data: JSON.stringify(news),
            success: function (data) {
                if (data.state == 0) {
                    top.location.replace("/html/index.html")
                } else {
                    alert(data.message)
                }
            }
        });

    }

    function getQueryVariable(variable) {
        var query = window.location.search.substring(1);
        var vars = query.split("&");
        for (var i = 0; i < vars.length; i++) {
            var pair = vars[i].split("=");
            if (pair[0] == variable) {
                return pair[1];
            }
        }
        return (false);
    }



    function getNewsFromParam() {
        news.id = getQueryVariable("newsId")
    }

    function getUserNameById(id) {
        $.ajax("/users/" + id, function () {
            if (data.state == 0) {
                console.log(data)
                user = data.data
                syncUI()
            } else {
                alert(data.message)
            }
        })
    }


    $(function () {
        getNewsFromParam()
        getNews(news.id)
        syncUI()
    })


</script>
</body>
</html>
